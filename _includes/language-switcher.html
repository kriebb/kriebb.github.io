<div class="language-switcher">
  {% for lang in site.languages %}
    {% if lang == site.active_lang %}
      <span class="active">{{ site.lang_names[lang] }}</span>
    {% else %}
      {% assign pages=site.pages | where:"ref", page.ref | where:"lang", lang %}
      {% for altpage in pages %}
        <a href="{{ altpage.url }}">{{ site.lang_names[lang] }}</a>
      {% endfor %}
    {% endif %}
  {% endfor %}
</div>