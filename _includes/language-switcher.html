<div class="language-switcher">
  {% for lang in site.languages %}
    {% if lang == site.active_lang %}
      <span class="active">{{ site.lang_names[lang] }}</span>
    {% else %}
      {% assign pages=site.pages | where:"ref", page.ref | where:"lang", lang %}
      {% for matched_page in pages limit:1 %}
        <a href="{{ matched_page.url }}" class="lang-link">{{ site.lang_names[lang] }}</a>
      {% endfor %}
    {% endif %}
  {% endfor %}
</div>